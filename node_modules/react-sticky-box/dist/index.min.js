import L,{useEffect as z,useRef as Y,useState as $}from"react";import M from"resize-observer-polyfill";var D=i=>{let e=i;for(;e=e.parentElement;){let s=getComputedStyle(e,null).getPropertyValue("overflow-y");if(e===document.body)return window;if(s==="auto"||s==="scroll")return e}return window},_=(i,e)=>{let s=i,n=0;e.firstChild&&e.firstChild.offsetParent!==e&&(n+=i.offsetTop-e.offsetTop,e=i.offsetParent,n+=-i.offsetTop);do n+=s.offsetTop,s=s.offsetParent;while(s&&s!==e);return n},V=i=>{let e=i.parentNode;for(;e&&getComputedStyle(e,null).getPropertyValue("display")==="contents";)e=e.parentNode;return e||window},T=null;typeof CSS<"u"&&CSS.supports&&(CSS.supports("position","sticky")?T="sticky":CSS.supports("position","-webkit-sticky")&&(T="-webkit-sticky"));var R=!1;try{N=Object.defineProperty({},"passive",{get(){R={passive:!0}}}),window.addEventListener("testPassive",null,N),window.removeEventListener("testPassive",null,N)}catch{}var N,j=(i,{offsetTop:e,offsetBottom:s,bottom:n})=>{let r=D(i),c=r===window?window.scrollY:r.scrollTop,v=[],l,p,a,h,w,f,u,k=()=>{if(l==="relative")return p;if(l==="stickyTop")return Math.max(0,f+c-h+e);if(l==="stickyBottom")return Math.max(0,f+c+u-(h+a+s))},E=t=>{t+f+u>=h+a+p+s&&d("stickyBottom")},d=t=>{if(l=t,t==="relative")if(i.style.position="relative",n){let o=Math.max(0,w-a-p);i.style.bottom=`${o}px`}else i.style.top=`${p}px`;else i.style.position=T,t==="stickyBottom"?n?i.style.bottom=`${s}px`:i.style.top=`${u-a-s}px`:n?i.style.bottom=`${u-a-s}px`:i.style.top=`${e}px`;p=k()},S=()=>{n?l!=="stickyBottom"&&d("stickyBottom"):l!=="stickyTop"&&d("stickyTop")},m=(t,o,y,P)=>{t.addEventListener(o,y,P),v.push(()=>t.removeEventListener(o,y))},g=()=>{let t=r===window?window.scrollY:r.scrollTop;if(t===c)return;if(a+e+s<=u){S(),c=t;return}let o=t-c;p=k(),o>0?l==="stickyTop"?t+f+e>h&&(t+f+u<=h+a+p+s?d("relative"):d("stickyBottom")):l==="relative"&&E(t):l==="stickyBottom"?f+t+u<h+w+s&&(f+t+e>=h+p?d("relative"):d("stickyTop")):l==="relative"&&f+t+e<h+p&&d("stickyTop"),c=t},b=()=>{u=window.innerHeight,f=0,g()},B=()=>{u=r.offsetHeight,r.firstChild.offsetParent===r?f=r.getBoundingClientRect().top:f=0,g()},H=()=>{let t=V(i),o=getComputedStyle(t,null),y=parseInt(o.getPropertyValue("padding-top"),10),P=parseInt(o.getPropertyValue("padding-bottom"),10),C=y+P;h=_(t,r)+y+f;let O=w;w=t.getBoundingClientRect().height-C,l==="relative"&&(n?d("relative"):O>w&&E(c)),O!==w&&l==="relative"&&(c=Number.POSITIVE_INFINITY,g())},I=({initial:t}={})=>{let o=a;if(a=i.getBoundingClientRect().height,!t&&o!==a)if(a+e+s<=u){l=void 0,S();return}else{let y=o-a,P=w-a,C=Math.min(P,k()+(n?y:0));p=Math.max(0,C),(!n||l!=="stickyBottom")&&d("relative")}},x=(t,o)=>{let y=new M(o);y.observe(t),v.push(()=>y.disconnect())};return m(r,"scroll",g,R),m(r,"mousewheel",g,R),r===window?(m(window,"resize",b),b()):(x(r,B),B()),x(V(i),H),H(),x(i,I),I({initial:!0}),S(),()=>v.forEach(t=>t())},A=({offsetTop:i=0,offsetBottom:e=0,bottom:s=!1}={})=>{let[n,r]=$(null),c=Y({offsetTop:i,offsetBottom:e,bottom:s});return z(()=>{c.current={offsetTop:i,offsetBottom:e,bottom:s}}),z(()=>{if(!!n)return j(n,c.current)},[n]),r},F=({offsetTop:i,offsetBottom:e,bottom:s,children:n,className:r,style:c})=>{let v=A({offsetTop:i,offsetBottom:e,bottom:s});return L.createElement("div",{className:r,style:c,ref:v},n)},G=F;export{G as default,A as useStickyBox};
